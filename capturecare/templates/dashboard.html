{% extends "base.html" %}

{% block title %}Dashboard - CaptureCare{% endblock %}

{% block content %}
<h1 class="text-4xl font-bold mb-8 text-gray-800">
    <i class="fas fa-chart-line text-brand-bright-teal mr-3"></i>
    System Dashboard
</h1>

<div class="grid md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium uppercase">Total Patients</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.total_patients }}</p>
            </div>
            <div class="bg-blue-100 rounded-full p-4">
                <i class="fas fa-users text-brand-bright-teal text-2xl"></i>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium uppercase">Connected</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.connected_patients }}</p>
            </div>
            <div class="bg-green-100 rounded-full p-4">
                <i class="fas fa-link text-brand-bright-teal text-2xl"></i>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium uppercase">Recent Data</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.recent_measurements }}</p>
            </div>
            <div class="bg-purple-100 rounded-full p-4">
                <i class="fas fa-database text-purple-600 text-2xl"></i>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm font-medium uppercase">Devices</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.total_devices }}</p>
            </div>
            <div class="bg-orange-100 rounded-full p-4">
                <i class="fas fa-heartbeat text-orange-600 text-2xl"></i>
            </div>
        </div>
    </div>
</div>

<div class="bg-white rounded-lg shadow-md p-8 mb-8">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">All Patients</h2>
        <div class="relative w-96">
            <input type="text" id="patientSearch" placeholder="Search patients by name or email..." 
                   class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-bright-teal focus:border-brand-bright-teal">
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
    </div>
    
    {% if all_patients %}
        <div id="patientsList" class="space-y-4 max-h-96 overflow-y-auto">
            {% for patient in all_patients %}
                <div class="patient-item flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition" 
                     data-name="{{ patient.first_name }} {{ patient.last_name }}" 
                     data-email="{{ patient.email }}">
                    <div class="flex items-center space-x-4">
                        <div class="bg-brand-bright-teal text-white rounded-full w-12 h-12 flex items-center justify-center font-bold text-lg">
                            {{ patient.first_name[0] }}{{ patient.last_name[0] }}
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800">{{ patient.first_name }} {{ patient.last_name }}</p>
                            <p class="text-sm text-gray-600">{{ patient.email }}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        {% if patient.withings_user_id %}
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-brand-teal">
                                <i class="fas fa-check"></i> Connected
                            </span>
                        {% else %}
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-gray-200 text-gray-600">
                                Not Connected
                            </span>
                        {% endif %}
                        <a href="{{ url_for('patient_detail', patient_id=patient.id) }}" 
                           class="bg-brand-bright-teal text-white px-4 py-2 rounded-lg hover:bg-brand-teal transition">
                            View
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-600 text-center py-8">No patients available</p>
    {% endif %}
</div>

<script>
document.getElementById('patientSearch').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const patientItems = document.querySelectorAll('.patient-item');
    
    patientItems.forEach(item => {
        const name = item.getAttribute('data-name').toLowerCase();
        const email = item.getAttribute('data-email').toLowerCase();
        
        if (name.includes(searchTerm) || email.includes(searchTerm)) {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
});
</script>

<div class="bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">Quick Actions</h2>
    
    <div class="grid md:grid-cols-3 gap-4">
        <a href="{{ url_for('add_patient') }}" 
           class="bg-brand-bright-teal text-white p-6 rounded-lg hover:bg-brand-teal transition text-center">
            <i class="fas fa-user-plus text-3xl mb-2"></i>
            <p class="font-semibold">Add New Patient</p>
        </a>
        
        <form action="{{ url_for('api_sync_all') }}" method="POST" class="contents">
            <button type="submit" 
                    class="bg-brand-bright-teal text-white p-6 rounded-lg hover:bg-brand-teal transition text-center">
                <i class="fas fa-sync text-3xl mb-2"></i>
                <p class="font-semibold">Sync All Patients</p>
            </button>
        </form>
        
        <a href="{{ url_for('patients_list') }}" 
           class="bg-purple-600 text-white p-6 rounded-lg hover:bg-purple-700 transition text-center">
            <i class="fas fa-list text-3xl mb-2"></i>
            <p class="font-semibold">View All Patients</p>
        </a>
    </div>
</div>
{% endblock %}
